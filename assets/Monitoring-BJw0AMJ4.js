import{c as m,u as A,r as l,D as I,j as e,L,a as E,B as C,A as z,C as u,b as y,d as g,e as R,f as j}from"./index-1iR8KGT1.js";import{r as o,o as D,d,g as T,R as B,T as K,a as Z,b as M,H as S,c as H,e as W,p as _}from"./tabs-DqSofg5F.js";const G=m("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);const O=m("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);const q=m("PlugZap",[["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z",key:"goz73y"}],["path",{d:"m2 22 3-3",key:"19mgm9"}],["path",{d:"M7.5 13.5 10 11",key:"7xgeeb"}],["path",{d:"M10.5 16.5 13 14",key:"10btkg"}],["path",{d:"m18 3-4 4h6l-4 4",key:"16psg9"}]]);const J=m("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);const Q=m("Waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),ee=()=>{const{toast:f}=A(),[x,i]=l.useState(!1),[v,b]=l.useState(!1),[F,N]=l.useState(0),[a,w]=l.useState({temperature:0,humidity:0,ph:0,waterLevel:0,lastUpdate:0}),[k,P]=l.useState([]);l.useEffect(()=>{const s=o(d,"sensors"),t=D(s,r=>{const n=r.val();if(n){const p={temperature:n.temperature||0,humidity:n.humidity||0,ph:n.ph||0,waterLevel:n.waterLevel||0,lastUpdate:n.lastUpdate||Date.now()};w(p),i(!0),V(p)}},()=>i(!1)),c=o(d,"sensorHistory"),h=D(c,r=>{const n=r.val();if(n){const p=Object.values(n).slice(-20);P(p)}});return()=>{t(),h()}},[]),l.useEffect(()=>{const s=setInterval(async()=>{const t=Date.now();try{const c=o(d,"sensors");(await T(c)).exists()?(i(!0),N(Date.now()-t)):i(!1)}catch{i(!1)}},1e4);return()=>clearInterval(s)},[]);const U=async()=>{b(!0);const s=Date.now();try{const t=o(d,"sensors"),c=await T(t),h=Date.now()-s;if(N(h),c.exists()){i(!0);const r=c.val();w({temperature:r.temperature||0,humidity:r.humidity||0,ph:r.ph||0,waterLevel:r.waterLevel||0,lastUpdate:r.lastUpdate||Date.now()}),f({title:"Koneksi Berhasil",description:"Terhubung kembali ke Firebase & Arduino"})}else throw new Error("No data")}catch{i(!1),f({title:"Koneksi Gagal",description:"Tidak dapat terhubung ke Firebase",variant:"destructive"})}finally{b(!1)}},V=async s=>{try{const t=o(d,"sensorHistory");await _(t,{timestamp:Date.now(),temperature:s.temperature,humidity:s.humidity,ph:s.ph,waterLevel:s.waterLevel})}catch(t){console.error("Error saving history:",t)}},$=[{title:"Suhu",value:`${a.temperature.toFixed(1)}째C`,icon:J,status:a.temperature>=20&&a.temperature<=35?"Normal":"Perlu Perhatian",color:a.temperature>=20&&a.temperature<=35?"text-primary":"text-red-500",range:"20째C - 35째C",gradient:"from-orange-500/20 to-red-500/20"},{title:"Kelembaban",value:`${a.humidity.toFixed(0)}%`,icon:I,status:a.humidity>=40&&a.humidity<=80?"Optimal":"Perlu Perhatian",color:a.humidity>=40&&a.humidity<=80?"text-primary":"text-red-500",range:"40% - 80%",gradient:"from-blue-500/20 to-cyan-500/20"},{title:"pH Air",value:a.ph.toFixed(1),icon:O,status:a.ph>=6&&a.ph<=7.5?"Normal":"Perlu Perhatian",color:a.ph>=6&&a.ph<=7.5?"text-primary":"text-red-500",range:"6.0 - 7.5",gradient:"from-purple-500/20 to-pink-500/20"},{title:"Level Air",value:`${a.waterLevel.toFixed(0)}%`,icon:Q,status:a.waterLevel>=30?"Baik":"Rendah",color:a.waterLevel>=30?"text-primary":"text-red-500",range:"30% - 100%",gradient:"from-teal-500/20 to-emerald-500/20"}];return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("nav",{className:"container mx-auto px-4 py-6 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(L,{to:"/",className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-8 h-8 text-primary"}),e.jsx("span",{className:"text-2xl font-bold glow-text",children:"Viridelis"})]}),e.jsx(L,{to:"/menu",children:e.jsxs(C,{variant:"ghost",className:"text-foreground hover:text-primary",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Kembali ke Menu"]})})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-12",children:[e.jsxs("div",{className:"text-center max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-5xl font-bold mt-4 mb-4",children:e.jsx("span",{className:"glow-text",children:"Monitoring Greenhouse"})}),e.jsx("p",{className:"text-muted-foreground text-lg mt-4 mb-4",children:"Pantau suhu, kelembaban, pH air, dan level air secara realtime"})]}),e.jsxs("div",{className:"text-center mb-10",children:[e.jsxs("div",{className:"flex justify-center items-center gap-4 mb-4",children:[e.jsxs("div",{className:"glass-card px-4 py-2 rounded-full flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${x?"bg-primary animate-pulse":"bg-red-500"}`}),e.jsx("span",{className:"font-semibold",children:x?"Live Monitoring":"Disconnected"})]}),e.jsxs(C,{onClick:U,disabled:v,variant:"outline",size:"sm",className:"glass-card",children:[e.jsx(B,{className:`w-4 h-4 mr-2 ${v?"animate-spin":""}`}),"Reconnect"]})]}),e.jsxs(K,{defaultValue:"realtime",className:"mb-8",children:[e.jsxs(Z,{className:"grid grid-cols-2 w-full max-w-md mx-auto",children:[e.jsx(M,{value:"realtime",children:"Data Realtime"}),e.jsxs(M,{value:"history",children:[e.jsx(S,{className:"w-4 h-4 mr-2"})," Riwayat"]})]}),e.jsxs(H,{value:"realtime",children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:$.map((s,t)=>e.jsxs(u,{className:"glass-card hover:shadow-[0_0_30px_rgba(74,222,128,0.2)]",children:[e.jsxs(y,{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-2xl mb-1",children:s.title}),e.jsxs(R,{children:["Rentang: ",s.range]})]}),e.jsx("div",{className:`bg-gradient-to-br ${s.gradient} p-3 rounded-xl`,children:e.jsx(s.icon,{className:"w-8 h-8 text-foreground"})})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-5xl font-bold text-primary",children:s.value}),e.jsxs("div",{className:`text-sm font-semibold ${s.color}`,children:["Status: ",s.status]})]})]},t))}),e.jsxs(u,{className:"glass-card mt-8",children:[e.jsx(y,{children:e.jsx(g,{children:"Status Koneksi"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex flex-wrap justify-start items-center gap-6 text-sm md:text-base",children:[e.jsxs("div",{className:"flex items-center gap-2 glass-card px-3 py-2 rounded-lg",children:[e.jsx(q,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold",children:"Firebase:"}),e.jsx("span",{className:`font-bold ${x?"text-primary":"text-red-500"}`,children:x?"Connected":"Disconnected"})]}),e.jsxs("div",{className:"flex items-center gap-2 glass-card px-3 py-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold",children:"Response Time:"}),e.jsxs("span",{className:"text-foreground font-bold",children:[F," ms"]})]}),e.jsxs("div",{className:"flex items-center gap-2 glass-card px-3 py-2 rounded-lg",children:[e.jsx(G,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold",children:"Last Update:"}),e.jsx("span",{className:"text-foreground",children:a.lastUpdate?new Date(a.lastUpdate).toLocaleString("id-ID"):"Waiting..."})]})]})})]})]}),e.jsx(H,{value:"history",children:e.jsxs(u,{className:"glass-card",children:[e.jsxs(y,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"})," Riwayat Sensor"]}),e.jsx(R,{children:"20 data terakhir"})]}),e.jsx(j,{children:e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:k.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Belum ada riwayat data"}):k.slice().reverse().map((s,t)=>e.jsx("div",{className:"glass-card p-4 rounded-lg flex justify-between text-sm",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:new Date(s.timestamp).toLocaleString("id-ID")}),e.jsxs("p",{className:"text-muted-foreground",children:["Suhu: ",s.temperature,"째C | RH: ",s.humidity,"% | pH:"," ",s.ph," | Level: ",s.waterLevel,"%"]})]})},t))})})]})})]})]})]})]})};export{ee as default};
